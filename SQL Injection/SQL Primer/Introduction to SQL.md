## ملخص عن SQL

- التطبيقات اللي بتعتمد على الويب (زي المواقع) بتستخدم قواعد بيانات عشان تخزن بيانات زي معلومات المستخدمين أو الإحصائيات.  
- أمثلة على قواعد البيانات: **MySQL**، **SQL Server**، **Oracle**، **PostgreSQL**، وغيرها.  
- عشان نقدر نتعامل مع قواعد البيانات دي، بنستخدم لغة اسمها **SQL**.  
- **SQL** دي لغة قوية بتساعدنا نستخرج ونعدل البيانات اللي جوه قاعدة البيانات.  
- التطبيقات بتكتب أوامر **SQL** (اللي بنسميها Queries) جوه الكود اللي بيتنفذ.

## ملخص عن Database Connectors

- الكود اللي على السيرفر هو المسؤول عن إنشاء والحفاظ على الاتصال بقاعدة البيانات باستخدام حاجة اسمها **Database Connectors**.  
- **Database Connectors** (أو اللي بنسميها أحيانًا Drivers) هي مكتبات أو مكونات برمجية بتوفر واجهة عشان تتواصل مع قاعدة بيانات معينة.  
- وظيفتها إنها تخلي التطبيقات تقدر تتكلم مع قاعدة البيانات، تنفذ Queries، تسترجع وتعدل البيانات، وكمان تتعامل مع المعاملات الخاصة بقواعد البيانات (Database Transactions).  
لإعادة رسم الرسم بنفس التنسيق نصيًا بلغة Markdown، يمكنني استخدام ASCII Art أو تركيبات النصوص لتقريب الفكرة. إليك الرسم مع شرح بسيط:

```markdown
## خطوات الاتصال بقاعدة البيانات

```plaintext
+---------------+
|   Application |
+---------------+
        |
        v
+---------------+
| Driver Manager|
+---------------+
        |
        v
+------------------+
| DSN Configuration|
+------------------+
        |
        v
+---------------+
| Connector/ODBC |
+---------------+
        |
        v
+---------------+
|  MySQL Server  |
+---------------+
```

### شرح 
- **Application**: هو التطبيق اللي بيحتاج يتعامل مع قاعدة البيانات.
- **Driver Manager**: بيقوم بإدارة الـ Drivers اللي بتستخدم للتعامل مع قواعد البيانات.
- **DSN Configuration**: إعدادات الـ DSN (Data Source Name) اللي بتحدد تفاصيل الاتصال بقاعدة البيانات.
- **Connector/ODBC**: هو الموصل أو الـ Driver اللي فعليًا بيتواصل مع قاعدة البيانات.
- **MySQL Server**: هو خادم قاعدة البيانات اللي بيتم تخزين البيانات عليه.


## مقدمة عن SQL

### قبل ما نتعلم إزاي نعمل هجوم SQL Injection، لازم نفهم الحاجات دي:

- **SQL Statement Syntax**: إزاي نكتب أوامر SQL بشكل صحيح.  
- **How to Perform a Query**: الطريقة اللي بننفذ بيها استعلام أو Query على قاعدة البيانات.  
- **UNION Operator**: إزاي ندمج نتايج استعلامين باستخدام عامل الـ UNION.  
- **Comments**: إزاي نكتب تعليقات في أوامر SQL وأهميتها.  


## أهم أوامر SQL

| **الأمر (Command)** | **الوظيفة (Function)**                                   |
|----------------------|--------------------------------------------------------|
| SELECT               | بيقرأ البيانات من قاعدة البيانات بناءً على شروط محددة.   |
| UNION                | بيستخدم لدمج نتائج استعلامين أو أكتر.                  |
| INSERT               | بيضيف سجل جديد لقاعدة البيانات أو الجدول.               |
| UPDATE               | بيعدل بيانات موجودة بناءً على شروط محددة.               |
| DELETE               | بيمسح بيانات موجودة بناءً على شروط محددة.               |
| ORDER BY             | بيستخدم لترتيب النتائج تصاعديًا أو تنازليًا.            |
| LIMIT BY             | بيحدد عدد السجلات اللي يتم استرجاعها من جدول أو أكتر.   |

---

## الرموز الخاصة في SQL

| **Command**             | **الوظيفة (Function)**                               |
|--------------------------|----------------------------------------------------|
| `'` or `"`              | لتحديد النصوص النصية.                               |
| `/* ... */`             | لكتابة تعليق متعدد الأسطر.                           |
| `+`                     | للجمع أو الربط بين النصوص.                          |
| `#` or `--`             | لكتابة تعليق لسطر واحد.                              |
| `||` (Double Pipe)       | لربط النصوص (Concatenation).                        |
| `%`                     | لاستخدام الرموز العامة (Wildcard) في البحث.          |
| `@variable`             | لتمثيل متغير محلي.                                  |
| `@@variable`            | لتمثيل متغير عام.                                   |
| `WAITFOR DELAY '00:00:10'` | لإضافة تأخير زمني.                                |





# جدول المنتجات (products)

| id  | name   | description         | price |
|-----|--------|---------------------|-------|
| 1   | Phone  | Smart phone device   | 500   |
| 2   | Laptop | Portable computer    | 1000  |
| 9   | Tablet | Touchscreen device   | 300   |

## SELECT Statement Syntax

الصيغة الأساسية لأمر SELECT:

```sql
SELECT <columns list> FROM <table> WHERE <condition>;
```

### مثال على أمر SELECT:

```sql
SELECT name, description FROM products WHERE id=9;
```

**Output:**

| name   | description        |
|--------|--------------------|
| Tablet | Touchscreen device |

الاستعلام ده بيطلب من قاعدة البيانات جلب قيم "name" و"description" لسجل موجود في جدول "products" بشرط إن الـ "id" يساوي 9.

## UNION Statement Syntax

الصيغة الأساسية لأمر UNION:

```sql
<SELECT statement> UNION <other SELECT statement>;
```

### مثال على أمر UNION:

```sql
SELECT name, description FROM products WHERE id=9 
UNION 
SELECT price FROM products WHERE id=9;
```

**Output:**

| name   | description        |
|--------|--------------------|
| Tablet | Touchscreen device |

| price |
|-------|
| 300   |

الاستعلام ده بيطلب من قاعدة البيانات جلب قيم "name" و"description" لسجل في جدول "products"، وفي نفس الوقت بيطلب جلب قيمة "price" لنفس السجل اللي الـ "id" بتاعه يساوي 9.



# SQL Comments

هناك نوعان من السلاسل التي يمكنك استخدامها لتعليق سطر في SQL:

- `#` (رمز الهاش)
- `--` (شرطان متتاليان متبوعان بمسافة)

### مثال:

```sql
SELECT field FROM table; # this is a comment
SELECT field FROM table; -- this is another comment
```



# إزاي التطبيقات الويبية بتستخدم SQL Queries

النص ده بيشرح إزاي تطبيق ويب بيتصل بقاعدة بيانات MySQL ويشغل استعلام SQL باستخدام PHP.

### مثال PHP للاتصال بقاعدة البيانات وتنفيذ استعلام SQL:

```php
### 1. الإعدادات (Configuration)
<?php
$dbhostname = '1.2.3.4';  // عنوان سيرفر قاعدة البيانات
$dbuser = 'username';      // اسم المستخدم لقاعدة البيانات
$dbpassword = 'password';  // كلمة المرور لقاعدة البيانات
$dbname = 'database';      // اسم قاعدة البيانات

// الاتصال بقاعدة البيانات
$connection = mysqli_connect($dbhostname, $dbuser, $dbpassword, $dbname);

// استعلام SQL لاختيار بيانات من جدولين باستخدام UNION
$query = "SELECT Name, Description FROM Products WHERE ID='3' 
          UNION 
          SELECT Username, Password FROM Accounts;";

// تنفيذ الاستعلام
$results = mysqli_query($connection, $query);

// دالة لعرض النتائج (لم يتم تنفيذها هنا)
display_results($results);
```

الكود ده بيعمل اتصال بقاعدة البيانات ويشغل استعلام SQL عشان يجيب بيانات من جدولين.



المثال اللي فات بيشرح إزاي الاستعلامات الثابتة بتستخدم جوه صفحة PHP:

- `$connection` هو كائن بيمثل الاتصال بقاعدة البيانات.
- متغير `$query` فيه الاستعلام بتاع SQL.
- `mysqli_query()` هي دالة بتبعت الاستعلام لقاعدة البيانات.
- وأخيرًا، دالة `display_results()` بتعرض البيانات اللي جت من قاعدة البيانات.

ده شرح بسيط للمكونات الأساسية في التعامل مع SQL في التطبيقات الويبية باستخدام PHP.


# استعلامات ديناميكية ضعيفة

في الغالب، الاستعلامات مش بتبقى ثابتة، بل بيتم بناؤها ديناميكيًا باستخدام مدخلات المستخدم. هنا مثال على استعلام ديناميكي ضعيف:

```php
$id = $_GET['id']; // استلام قيمة 'id' من مدخلات المستخدم عبر الـ GET request
$connection = mysqli_connect($dbhostname, $dbuser, $dbpassword, $dbname); // الاتصال بقاعدة البيانات
$query = "SELECT Name, Description FROM Products WHERE ID='$id';"; // بناء استعلام SQL باستخدام مدخلات المستخدم
$results = mysqli_query($connection, $query); // تنفيذ الاستعلام على قاعدة البيانات
display_results($results); // عرض النتائج للمستخدم
```

---

# خطر استخدام مدخلات المستخدم في بناء الاستعلامات

● المثال السابق بيبين كود بيستخدم مدخلات المستخدم لبناء استعلام (عنصر `id` من طلب الـ GET).
● الكود بعد كده بيقدم الاستعلام لقاعدة البيانات.
● السلوك ده خطير جدًا لأن مستخدم خبيث ممكن يستغل بناء الاستعلام عشان يتحكم في التفاعل مع قاعدة البيانات.

## إزاي ده بيحصل؟ خلينا نشوف!

الاستعلام الديناميكي:
```sql
SELECT Name, Description FROM Products WHERE ID='$id';
```

بيستقبل قيم `$id` زي:

- `1` - الاستعلام هيكون:
  ```sql
  SELECT Name, Description FROM Products WHERE ID='1';
  ```

- `Example` - الاستعلام هيكون:
  ```sql
  SELECT Name, Description FROM Products WHERE ID='Example';
  ```

- `Itid3` - الاستعلام هيكون:
  ```sql
  SELECT Name, Description FROM Products WHERE ID='Itid3';
  ```

لكن، لو المهاجم صنع قيمة `$id` اللي ممكن تغير الاستعلام؟ حاجة زي:
```sql
' OR 'a'='a
```

الاستعلام هيبقى:
```sql
SELECT Name, Description FROM Products WHERE ID='' OR 'a'='a';
```

ده بيقول لقاعدة البيانات إنها تختار العناصر بناءً على شرطين:
- إن الـ `id` يكون فاضي (`id=''`)
- أو شرط دايمًا صحيح (`'a'='a'`)

● في الوقت اللي الشرط الأول مش متحقق، محرك SQL هيشوف الشرط التاني من الـ OR. الشرط التاني ده مصنوع كشرط دايمًا صحيح.
● بمعنى تاني، ده بيقول لقاعدة البيانات إنها تختار كل العناصر الموجودة في جدول الـ Products!
